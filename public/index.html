<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Document Generator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        label { display: block; margin-top: 12px; font-weight: bold; }
        input { width: 100%; padding: 8px; margin-top: 6px; box-sizing: border-box; }
        button { margin-top: 16px; padding: 10px 14px; }
        .success { margin-top: 16px; color: green; }
        .error { margin-top: 16px; color: red; }
        .preview-pane { margin-top: 20px; }
        .frames { display: grid; grid-template-columns: 1fr; gap: 12px; }
        @media (min-width: 900px) { .frames { grid-template-columns: 1fr 1fr; } }
        .frames iframe { width: 100%; height: 65vh; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; }
    </style>
    <script>
        // Auto-select backend: Supabase on hosted, Node on localhost
        const isLocal = ['localhost','127.0.0.1'].includes(location.hostname);
        if (isLocal) {
            window.API_GENERATE_URL = '/api/generate';
            window.API_PREVIEW_URL  = '/api/preview';
            window.SUPABASE_ANON_KEY = '';
        } else {
            window.API_GENERATE_URL = 'https://kdisvxgqqskpxgxzbbet.functions.supabase.co/generate-docs';
            window.API_PREVIEW_URL  = 'https://kdisvxgqqskpxgxzbbet.functions.supabase.co/generate-docs-preview';
            window.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtkaXN2eGdxcXNrcHhneHpiYmV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyOTUwMTMsImV4cCI6MjA3Mzg3MTAxM30.LZgSUHWQgAzYREA4IZF7h1DAPdL4JBRgn0U-T6o7LFE';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script>
        // Configurable API URLs: set window.API_GENERATE_URL and window.API_PREVIEW_URL for Supabase
        // Example: window.API_GENERATE_URL = 'https://YOUR_PROJECT_REF.functions.supabase.co/generate-docs'
        const API_GENERATE_URL = window.API_GENERATE_URL || '/api/generate';
        const API_PREVIEW_URL = window.API_PREVIEW_URL || '/api/preview';
        async function submitForm(event) {
            event.preventDefault();
            const form = event.target;
            const data = Object.fromEntries(new FormData(form).entries());

            const payload = {
                name: data.name?.trim(),
                phone: data.phone?.trim(),
                email: data.email?.trim(),
                squareMeters: data.squareMeters?.trim(),
                amount: data.amount?.trim(),
                paymentRef: data.paymentRef?.trim(),
            };

            // Always generate styled documents client-side to match preview
            const styled = await generateStyledPdfs({
                name: payload.name,
                phone: payload.phone,
                email: payload.email,
                squareMeters: payload.squareMeters,
                amount: payload.amount,
                paymentRef: payload.paymentRef,
            });
            payload.receiptPngBase64 = styled.receiptPngBase64;
            payload.certPngBase64 = styled.certPngBase64;
            payload.deedBase64 = styled.deedBase64;

            const status = document.getElementById('status');
            status.textContent = 'Generating and sending documents...';
            status.className = '';

            try {
                const headers = { 'Content-Type': 'application/json' };
                if (window.SUPABASE_ANON_KEY) {
                    headers['apikey'] = window.SUPABASE_ANON_KEY;
                    headers['Authorization'] = `Bearer ${window.SUPABASE_ANON_KEY}`;
                }
                const res = await fetch(API_GENERATE_URL, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify(payload),
                });
                const raw = await res.text();
                let body;
                try { body = JSON.parse(raw); } catch { body = null; }
                if (!res.ok || !body?.ok) throw new Error(body?.error || `Request failed: ${res.status} ${raw.slice(0,200)}`);
                status.textContent = 'Success! Documents have been emailed.';
                status.className = 'success';
                form.reset();
            } catch (err) {
                status.textContent = 'Error: ' + err.message;
                status.className = 'error';
            }
        }

        async function previewDocs(event) {
            event.preventDefault();
            const form = document.querySelector('form');
            const data = Object.fromEntries(new FormData(form).entries());
            const payload = {
                name: data.name?.trim(),
                phone: data.phone?.trim(),
                email: data.email?.trim(),
                squareMeters: data.squareMeters?.trim(),
                amount: data.amount?.trim(),
                paymentRef: data.paymentRef?.trim(),
            };

            const status = document.getElementById('status');
            status.textContent = 'Generating preview...';
            status.className = '';

            try {
                const headers = { 'Content-Type': 'application/json' };
                if (window.SUPABASE_ANON_KEY) {
                    headers['apikey'] = window.SUPABASE_ANON_KEY;
                    headers['Authorization'] = `Bearer ${window.SUPABASE_ANON_KEY}`;
                }
                const res = await fetch(API_PREVIEW_URL, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify(payload),
                });
                const raw = await res.text();
                let body;
                try { body = JSON.parse(raw); } catch { body = null; }
                if (!res.ok || !body?.ok) throw new Error(body?.error || `Preview failed: ${res.status} ${raw.slice(0,200)}`);

                // Get the base64 data from response - receipt and certificate as SVG, deed as PDF
                const recSvg = body.receiptJpgBase64 || null;
                const certSvg = body.certificatePngBase64 || null;
                const deedPdf = body.deedPdfBase64 || null;

                // Create data URLs - using SVG for images (more reliable than JPG/PNG generation)
                let recUrl = null;
                let certUrl = null;
                let deedUrl = null;
                if (recSvg) recUrl = `data:image/svg+xml;base64,${recSvg}`;
                if (certSvg) certUrl = `data:image/svg+xml;base64,${certSvg}`;
                if (deedPdf) deedUrl = `data:application/pdf;base64,${deedPdf}`;

                if (!recUrl || !certUrl || !deedUrl) throw new Error('Preview data missing from server response');

                const preview = document.getElementById('preview');
                const receiptFrame = document.getElementById('receiptFrame');
                const certFrame = document.getElementById('certFrame');
                const deedFrame = document.getElementById('deedFrame');
                
                if (receiptFrame && certFrame && deedFrame && preview) {
                    receiptFrame.src = recUrl;
                    certFrame.src = certUrl;
                    deedFrame.src = deedUrl;
                    preview.style.display = '';
                }

                status.textContent = 'Preview ready below.';
                status.className = 'success';
            } catch (err) {
                status.textContent = 'Error: ' + err.message;
                status.className = 'error';
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Generate Documents</h1>
        <form onsubmit="submitForm(event)">
            <label for="name">Name</label>
            <input id="name" name="name" required />

            <label for="phone">Phone number</label>
            <input id="phone" name="phone" required />

            <label for="email">Email</label>
            <input id="email" name="email" type="email" required />

            <label for="squareMeters">Number of square meters</label>
            <input id="squareMeters" name="squareMeters" type="number" step="0.01" required />

            <label for="amount">Amount</label>
            <input id="amount" name="amount" type="number" step="0.01" required />

            <label for="paymentRef">Receipt payment reference #</label>
            <input id="paymentRef" name="paymentRef" placeholder="e.g. TRX-12345" />

            <!-- Styled PDFs are always used; toggle hidden -->

            <div style="display:flex; gap:8px;">
                <button type="button" onclick="previewDocs(event)">Generate PDFs</button>
                <button type="submit">Send Email</button>
            </div>
        </form>
        <div id="status"></div>

        <div id="preview" class="preview-pane" style="display:none;">
            <h2>Preview</h2>
            <div class="frames">
                <iframe id="receiptFrame" title="Receipt Preview"></iframe>
                <iframe id="certFrame" title="Certificate Preview"></iframe>
                <iframe id="deedFrame" title="Deed of Sale Preview"></iframe>
            </div>
        </div>
    </div>

    <script>
        function escapeXml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
        function buildReceiptSvg({name,phone,email,squareMeters,amount,paymentRef}){
            return `
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <rect width="100%" height="100%" fill="#ffffff" stroke="#ddd" stroke-width="1"/>
  <text x="400" y="40" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50" text-anchor="middle">Focal Point Property Development and Management Services Ltd.</text>
  <text x="400" y="60" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d" text-anchor="middle">2 Seasons, Off Kobape-Abeokuta Expressway, Gbako Village</text>
  <text x="400" y="80" font-family="Arial, sans-serif" font-size="10" fill="#7f8c8d" text-anchor="middle">Abeokuta, Ogun State, Nigeria</text>
  <line x1="50" y1="110" x2="750" y2="110" stroke="#3498db" stroke-width="2"/>
  <text x="400" y="140" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2c3e50" text-anchor="middle">PAYMENT RECEIPT</text>
  <text x="400" y="165" font-family="Arial, sans-serif" font-size="12" fill="#7f8c8d" text-anchor="middle">Receipt #: RCP-${Date.now()}</text>
  <text x="400" y="185" font-family="Arial, sans-serif" font-size="12" fill="#7f8c8d" text-anchor="middle">Date: ${new Date().toLocaleDateString()} | Payment Ref #: ${escapeXml(paymentRef||'-')}</text>
  <rect x="50" y="210" width="700" height="80" fill="#f8f9fa" stroke="#bdc3c7" stroke-width="1"/>
  <text x="70" y="235" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">CUSTOMER INFORMATION</text>
  <text x="70" y="260" font-family="Arial, sans-serif" font-size="12" fill="#000">Name: ${escapeXml(name)}</text>
  <text x="70" y="280" font-family="Arial, sans-serif" font-size="12" fill="#000">Phone: ${escapeXml(phone)}</text>
  <rect x="50" y="310" width="700" height="100" fill="#e8f5e8" stroke="#27ae60" stroke-width="1"/>
  <text x="70" y="335" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#27ae60">PAYMENT DETAILS</text>
  <text x="70" y="360" font-family="Arial, sans-serif" font-size="12" fill="#000">Property Size: ${escapeXml(squareMeters)} sq. meters</text>
  <text x="70" y="380" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#27ae60">Amount Paid: N${Number(amount).toLocaleString()}</text>
  <line x1="50" y1="570" x2="750" y2="570" stroke="#bdc3c7" stroke-width="1"/>
  <text x="400" y="590" font-family="Arial, sans-serif" font-size="9" fill="#7f8c8d" text-anchor="middle">Focal Point Property Development and Management Services Ltd. | www.subxhq.com | subx@focalpointdev.com</text>
</svg>`;
        }
        function buildCertSvg({name,phone,email,squareMeters,amount}){
            return `
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <rect width="100%" height="100%" fill="#ffffff" stroke="#2c3e50" stroke-width="4"/>
  <rect x="10" y="10" width="780" height="580" fill="none" stroke="#34495e" stroke-width="1"/>
  <rect x="10" y="10" width="20" height="20" fill="#2c3e50"/>
  <rect x="770" y="10" width="20" height="20" fill="#2c3e50"/>
  <rect x="10" y="570" width="20" height="20" fill="#2c3e50"/>
  <rect x="770" y="570" width="20" height="20" fill="#2c3e50"/>
  <text x="400" y="50" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2c3e50" text-anchor="middle">Focal Point Property Development and Management Services Ltd.</text>
  <text x="400" y="75" font-family="Arial, sans-serif" font-size="12" fill="#7f8c8d" text-anchor="middle">2 Seasons, Off Kobape-Abeokuta Expressway, Gbako Village</text>
  <text x="400" y="95" font-family="Arial, sans-serif" font-size="12" fill="#7f8c8d" text-anchor="middle">Abeokuta, Ogun State, Nigeria</text>
  <line x1="100" y1="120" x2="700" y2="120" stroke="#3498db" stroke-width="2"/>
  <text x="400" y="160" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#2c3e50" text-anchor="middle">CERTIFICATE OF OWNERSHIP</text>
  <text x="400" y="190" font-family="Arial, sans-serif" font-size="16" fill="#7f8c8d" text-anchor="middle">This is to certify that</text>
  <text x="400" y="220" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#e74c3c" text-anchor="middle">${escapeXml(name)}</text>
  <text x="400" y="250" font-family="Arial, sans-serif" font-size="14" fill="#7f8c8d" text-anchor="middle">is recognized as the legal owner of the property described below:</text>
  <rect x="80" y="280" width="640" height="120" fill="#f8f9fa" stroke="#bdc3c7" stroke-width="1"/>
  <text x="100" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">PROPERTY DETAILS</text>
  <text x="100" y="330" font-family="Arial, sans-serif" font-size="12" fill="#000">Project: 2 Seasons</text>
  <text x="100" y="355" font-family="Arial, sans-serif" font-size="12" fill="#000">Property Size: ${escapeXml(squareMeters)} sq. meters</text>
  <text x="100" y="380" font-family="Arial, sans-serif" font-size="12" fill="#000">Consideration Amount: N${Number(amount).toLocaleString()}</text>
  <text x="100" y="550" font-family="Arial, sans-serif" font-size="12" fill="#000">Signed by: Tolulope Olugbode, Founder</text>
  <text x="100" y="570" font-family="Arial, sans-serif" font-size="12" fill="#000">Date: ${new Date().toLocaleDateString()}</text>
</svg>`;
        }

        async function svgToPngBase64(svg){
            const svgBlob = new Blob([svg], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);
            const img = new Image();
            await new Promise((resolve,reject)=>{ img.onload=resolve; img.onerror=reject; img.src=url; });
            const c = document.createElement('canvas');
            c.width = img.width || 800;
            c.height = img.height || 600;
            const ctx = c.getContext('2d');
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0,0,c.width,c.height);
            ctx.drawImage(img, 0, 0, c.width, c.height);
            const pngData = c.toDataURL('image/png', 0.9);
            URL.revokeObjectURL(url);
            return pngData.split(',')[1];
        }

        async function generateStyledPdfs({ name, phone, email, squareMeters, amount, paymentRef }) {
            const receiptSvg = buildReceiptSvg({ name, phone, email, squareMeters, amount, paymentRef });
            const certSvg = buildCertSvg({ name, phone, email, squareMeters, amount });
            const receiptPngBase64 = await svgToPngBase64(receiptSvg);
            const certPngBase64 = await svgToPngBase64(certSvg);
            // Deed PDF (comprehensive legal format)
            const { jsPDF } = window.jspdf;
            const deedPdf = new jsPDF({ orientation:'p', unit:'pt', format:'a4' });
            let y = 40;
            const currentDate = new Date();
            const day = currentDate.getDate();
            const month = currentDate.toLocaleString('default', { month: 'long' });
            const year = currentDate.getFullYear();
            const rcNumber = "RC-1234567";
            const plotReference = `PLOT-${Date.now().toString().slice(-6)}`;
            
            deedPdf.setFont('helvetica','bold'); deedPdf.setFontSize(18); deedPdf.text('DEED OF SALE', 50, y); y+=30;
            deedPdf.setFont('helvetica','normal'); deedPdf.setFontSize(10);
            
            const lines = [
              '',
              `THIS DEED OF ASSIGNMENT is made this ${day} day of ${month}, ${year} BETWEEN:`,
              '',
              `(1) FOCAL POINT PROPERTY DEVELOPMENT AND MANAGEMENT SERVICES LTD., a company`,
              `incorporated under the laws of the Federal Republic of Nigeria with RC No. ${rcNumber}`,
              `and having its registered office at 2 Seasons, Off Kobape-Abeokuta Expressway,`,
              `Gbako Village, Ogun State (hereinafter referred to as the "Assignor" or "FOCAL POINT"); and`,
              '',
              `(2) ${name.toUpperCase()}, of [Assignee Address] (hereinafter referred to as the "Assignee").`,
              '',
              `RECITALS`,
              '',
              `A. The Assignor is the registered owner/developer of a parcel of land known as`,
              `Plot/Phase: ${plotReference}, situate at 2 Seasons, Off Kobape-Abeokuta Expressway,`,
              `Gbako Village, Ogun State ("the Project" or "the Plot").`,
              '',
              `B. The Assignor has created a scheme of sub-ownership whereby the Assignor sells`,
              `individual square-metre units (each being "1 sqm") of the said Plot to purchasers,`,
              `subject to the terms, conditions and restrictions set out in this Deed.`,
              '',
              `C. The Assignee has agreed to purchase from the Assignor and the Assignor has`,
              `agreed to sell to the Assignee a total of ${squareMeters} square metres`,
              `(hereinafter referred to as the "Subject Units" or "the Units") of the Plot,`,
              `being part of the said Plot, for the sum of ${Number(amount).toLocaleString()} Naira`,
              `(₦${Number(amount).toLocaleString()}) (the "Purchase Price").`,
              '',
              `NOW THIS DEED WITNESSES as follows:`,
              '',
              `1. TRANSFER AND ASSIGNMENT`,
              `   1.1 In consideration of the Purchase Price (receipt of which the Assignor hereby`,
              `acknowledges), the Assignor hereby assigns, conveys and transfers to the Assignee`,
              `all the Assignor's rights, title and interest in and to the Subject Units described`,
              `as [DESCRIPTION / LOCATION WITHIN PLOT / SURVEY REFERENCE] and tied to Plot`,
              `Reference ${plotReference}.`,
              `   1.2 The Assignee shall be entitled to possess and enjoy the Subject Units as`,
              `legal owner, subject to the terms, reservations and covenants contained in this Deed.`,
              '',
              `2. NATURE OF OWNERSHIP`,
              `   2.1 The Assignee's ownership is a sub-ownership in square metres (sqm) and is`,
              `specifically tied to the above-mentioned Plot/Plot Reference. The ownership is not`,
              `a free-standing registered parcel separate from the Plot until such time as the`,
              `Assignor (or relevant registry) effects any permissible consolidation/registration`,
              `in accordance with applicable law and the terms of any internal scheme documents.`,
              `   2.2 The Assignee acknowledges that the Subject Units form part of a larger`,
              `development and accepts any common infrastructure, restrictions, covenants, and`,
              `management arrangements that apply to the Project.`,
              '',
              `3. WAIT/LOCK-IN PERIOD BEFORE RESALE`,
              `   3.1 The Assignee covenants and agrees that the Subject Units shall not be offered`,
              `for sale, assigned, transferred, charged, pledged, or otherwise disposed of in`,
              `whole or in part for a period of twenty-four (24) calendar months (the "Wait Period")`,
              `commencing from the Date of this Deed.`,
              `   3.2 Notwithstanding Clause 3.1, the Assignor may, in its sole discretion and by`,
              `express prior written consent, permit an earlier transfer. Any attempted sale,`,
              `assignment or transfer in contravention of this Clause 3 shall be null and void`,
              `and of no effect.`,
              '',
              `4. RESTRICTION ON DISPOSAL / EXPRESS PERMISSION`,
              `   4.1 Following the expiry of the Wait Period, the Assignee shall still not sell,`,
              `transfer, assign, charge or otherwise dispose of the Subject Units without the`,
              `prior express written permission of:`,
              `       (a) Focal Point Property Development and Management Services Ltd. (the Assignor); and`,
              `       (b) any other co-owners or parties as may be expressly required under the`,
              `Project's title documents, management rules, or any encumbrance registered`,
              `against the Plot (collectively "Required Consent Parties").`,
              `   4.2 The Required Consent Parties shall not unreasonably withhold consent where`,
              `the Assignee is in full compliance with all Project rules, payments, and`,
              `obligations; provided that the Assignor reserves a right of first refusal or`,
              `first offer on resale consistent with the Assignor's internal resale policy,`,
              `which the Assignee agrees to honour.`,
              '',
              `5. TITLE, WARRANTIES AND INDEMNITY`,
              `   5.1 The Assignor warrants that it has, at the date of this Deed, good and`,
              `marketable title to the Plot and the right to sell the Subject Units.`,
              `   5.2 The Assignor makes no warranty as to future planning approvals, service`,
              `connections, or infrastructure completion timelines, save where expressly provided`,
              `in writing elsewhere.`,
              `   5.3 The Assignee shall indemnify and keep indemnified the Assignor against all`,
              `losses, claims, demands, fines or expenses arising from any breach of this Deed`,
              `by the Assignee, including any attempted unauthorized transfer.`,
              '',
              `6. PAYMENT AND RECEIPT`,
              `   6.1 The Assignee has paid or will pay the Purchase Price in accordance with the`,
              `payment schedule agreed between the parties. Receipt of any payment shall be`,
              `evidenced by a formal receipt signed by the Assignor.`,
              `   6.2 Non-payment in accordance with the agreed schedule may result in forfeiture,`,
              `penalties or cancellation in accordance with the Assignor's sales policy.`,
              '',
              `7. REGISTRATION AND COSTS`,
              `   7.1 The Assignee shall be responsible for any applicable registration, stamp`,
              `duties, legal fees or other charges associated with registering or recording this`,
              `Deed or any permitted transfer, unless otherwise agreed in writing.`,
              `   7.2 Where the Assignor is required to effect administrative changes to title`,
              `documentation on behalf of the Assignee, the Assignee shall reimburse the`,
              `Assignor for reasonable costs incurred.`,
              '',
              `8. DEFAULT AND REMEDIES`,
              `   8.1 In the event of breach by the Assignee (including any attempt to transfer`,
              `in contravention of Clause 3 or Clause 4), the Assignor may take such actions as`,
              `may be permitted by law and this Deed, including cancellation of the sale,`,
              `retention of payments as liquidated damages, or seeking injunctive relief.`,
              `   8.2 The remedies provided in this Deed are cumulative and without prejudice to`,
              `any other remedies available at law or in equity.`,
              '',
              `9. NOTICES`,
              `   9.1 Any notice required to be given under this Deed shall be in writing and`,
              `shall be given by hand delivery, registered post or courier to the addresses`,
              `stated above or to such other address as a party may notify in writing.`,
              '',
              `10. ENTIRE AGREEMENT`,
              `   10.1 This Deed constitutes the entire agreement between the parties with respect`,
              `to the subject matter hereof and supersedes all prior negotiations,`,
              `representations or agreements, whether written or oral.`,
              '',
              `11. SEVERABILITY`,
              `   11.1 If any provision of this Deed is held to be invalid, illegal, or`,
              `unenforceable, the remaining provisions shall continue in full force and effect.`,
              '',
              `12. GOVERNING LAW AND JURISDICTION`,
              `   12.1 This Deed shall be governed by and construed in accordance with the laws`,
              `of the Federal Republic of Nigeria. The parties submit to the exclusive`,
              `jurisdiction of the courts of Ogun State, Nigeria, for the resolution of any`,
              `disputes arising from this Deed.`,
              '',
              `13. ASSIGNOR'S OBLIGATIONS`,
              `   13.1 The Assignor shall ensure that the Subject Units remain tied to the`,
              `identified Plot/Plot Reference and shall not execute or permit any encumbrance`,
              `or disposition that would materially prejudice the Assignee's ownership without`,
              `prior notice to the Assignee, except as required by law.`,
              '',
              `14. MISCELLANEOUS`,
              `   14.1 Headings are for convenience only and shall not affect interpretation.`,
              `   14.2 Words importing the singular include the plural and vice versa where the`,
              `context so requires.`,
              '',
              `IN WITNESS WHEREOF the parties hereto have executed this Deed on the Date first`,
              `above written.`,
              '',
              `SIGNED by or on behalf of:`,
              `FOCAL POINT PROPERTY DEVELOPMENT AND MANAGEMENT SERVICES LTD.`,
              `______________________________`,
              `Signature: _____________________`,
              `Name: Tolulope Olugbode`,
              `Title: Founder`,
              `Date: ${currentDate.toLocaleDateString()}`,
              '',
              `SIGNED by:`,
              `${name.toUpperCase()}`,
              `______________________________`,
              `Signature: _____________________`,
              `Name: ${name}`,
              `Date: ${currentDate.toLocaleDateString()}`,
              '',
              `WITNESSES:`,
              `1. Name: ______________________ Signature: __________________ Date: ___________`,
              `2. Name: ______________________ Signature: __________________ Date: ___________`,
              '',
              `SCHEDULE A – DESCRIPTION OF SUBJECT UNITS`,
              `- Plot Reference: ${plotReference}`,
              `- Location: 2 Seasons, Off Kobape-Abeokuta Expressway, Gbako Village, Ogun State`,
              `- Number of Square Metres Purchased: ${squareMeters} sqm`,
              `- Unit Identification: [UNIT ID OR BLOCK REFERENCES]`,
              '',
              `SCHEDULE B – PAYMENT SCHEDULE`,
              `- Total Purchase Price: ₦${Number(amount).toLocaleString()}`,
              `- Payment Terms: Paid in full`,
            ];
            
            for (const ln of lines){ 
              if (y > 800) { // Add new page if content exceeds page height
                deedPdf.addPage();
                y = 40;
              }
              deedPdf.text(ln, 50, y); 
              y += 12; // Reduced line spacing for more content
            }
            const deedBase64 = deedPdf.output('datauristring').split(',')[1];
            return { receiptPngBase64, certPngBase64, deedBase64 };
        }
    </script>
</body>
</html>


